% $Id: ESMF_testing.tex,v 1.19 2004/07/01 21:11:42 svasquez Exp $

\subsection{Running ESMF Self-Tests}
\label{testing}

Robustness and portability are primary goals of the ESMF development
effort.  To ensure that these goals are met, the ESMF includes a
comprehesive suite of tests.  They allow testing and validation of
everything from individual functions to complete system tests.  These
test suites are used by the ESMF development team as part of their
regular development process.  ESMF users can run the testing suites to
verify that the framework software was built and installed properly,
and is running correctly on a particular platform.

Test targets will compile the ESMF library if it has not already been built.

\subsubsection{Running ESMF Unit Tests}

\label{UnitTestDescription}
The unit tests provided with the ESMF library evaluate the following:
\begin{itemize}
\item correctness of individual functions
\item behavior of individual modules or classes
\item appropriate error handling
\end{itemize}

Unit tests can be run in either an exhaustive or a non-exhaustive (sanity check)
mode.  The exhaustive mode includes the sanity check tests.  Typically, sanity
checks for each ESMF capability include creating and destroying an object and 
testing its basic function using a valid argument set.  In the exhaustive mode,
a wide range of valid and non-valid arguments are evaluated for correct behavior.

\label{RunUnitTests}

The following commands are used to build and run the unit tests provided with 
the ESMF:
\begin{verbatim}
        gmake [ESMF_EXHAUSTIVE=<ON,OFF>] tests
        gmake [ESMF_EXHAUSTIVE=<ON,OFF>] tests_uni
\end{verbatim}

The {\tt tests\_uni} target runs the tests on a single processor. 
The {\tt tests} target runs the test on multiple processors.

The non-exhaustive set of unit tests should all pass.  At this point in 
development, the exhaustive tests do not all pass.  Current problems with 
unit tests are being tracked and corrected by the ESMF development team.

The results of running the unit tests can be found in the following location:
\begin{verbatim}
${ESMF_DIR}/test/test${ESMF_BOPT}/${ESMF_ARCH}.${ESMF_COMPILER}.${ESMF_PREC}.${ESMF_SITE}
\end{verbatim}

For example, if your esmf source files have been placed in: 
\begin{verbatim}
       /usr/local/esmf
\end{verbatim}

If your platform is a Linux uni-processor that has an installed Lahey
Fortran compiler and ESMF\_COMPILER has been set to lahey, then the build
system configuration file will be:

\begin{verbatim}
      build_config/Linux.lahey.default/build_rules.mk
\end{verbatim}

If you want to run a debug version of non-exhaustive unit tests,
then you use these commands from /usr/local/esmf:

\begin{verbatim}
       setenv ESMF_DIR /usr/local/esmf
       gmake ESMF_BOPT=g ESMF_SITE=lahey ESMF_EXHAUSTIVE=OFF tests_uni
\end{verbatim}


If you are using ksh, then replace the setenv command with:
\begin{verbatim}
       export ESMF_DIR=/usr/local/esmf
\end{verbatim}

The results of the unit tests will be in:
\begin{verbatim}
       /usr/local/esmf/test/testg/Linux.lahey.32.default/
\end{verbatim}

At the end of unit test execution a script runs to analyze the results.

The script output indicates whether there are any unit test failures.
The following is a sample from the script output:

\begin{verbatim}

Unit Tests stdout files found: 
-rw-r--r--    1 svasquez scd           576 Apr 25 10:31 ESMF_ArrayBasicUTest.stdout
-rw-r--r--    1 svasquez scd           960 Apr 25 10:31 ESMF_ArrayF90PtrUTest.stdout
-rw-r--r--    1 svasquez scd          7791 Apr 25 10:31 ESMF_ArrayUTest.stdout
-rw-r--r--    1 svasquez scd            99 Apr 25 10:31 ESMF_BaseUTest.stdout
-rw-r--r--    1 svasquez scd          1690 Apr 25 10:31 ESMF_BundleUTest.stdout
-rw-r--r--    1 svasquez scd         73209 Apr 25 10:31 ESMF_ClockUTest.stdout
-rw-r--r--    1 svasquez scd          2585 Apr 25 10:31 ESMF_FieldUTest.stdout
-rw-r--r--    1 svasquez scd           399 Apr 25 10:31 ESMF_GridUTest.stdout
-rw-r--r--    1 svasquez scd          6484 Apr 25 10:32 ESMF_StateUTest.stdout

Unit test stdout files of zero length indicate that the unit test
did not run because it failed to compile or it failed to execute. 

112  Unit Tests passed 

No Unit Tests Failed.

\end{verbatim}

The following is an example of the output generated when a unit test fails:
\begin{verbatim}
ESMF_FieldUTest.stdout: FAIL  Unique default Field names Test, FLD1.5.1 & 1.7.1,
                        ESMF_FieldUTest.F90, line 204  Field names not unique
\end{verbatim}

\subsubsection{Running ESMF System Tests}
\label{SystemTestDescription}

The system tests provided with the ESMF library evaluate:
\begin{itemize}
\item interface agreement between parts of the system
\item behavior of the system as a whole
\end{itemize}

The current system test suite includes tests that perform layout
reduction operations, redistribution-transpose, halo operations,
component creation and intra-grid communication.  Some of the system
tests are no longer compatible with the current API, but are included
in the release for completeness.  A complete description of each
available system test and its current compatibility status can be
found at the ESMF website,
\htmladdnormallink{http://www.esmf.ucar.edu}{http://www.esmf.ucar.edu}.  
The testing
and validation page is accessible from the {\bf Development} 
link on the navigation bar.

The following commands are used to build and run the system tests:

\begin{verbatim}
        gmake [SYSTEM_TEST=xxx] system_tests
        gmake [SYSTEM_TEST=xxx] system_tests_uni
\end{verbatim}

The {\tt system\_tests\_uni} target runs the tests on a single processor. 
The {\tt system\_tests} target runs the test on multiple processors.

If a particular SYSTEM\_TEST is not specified, then all available system tests 
are built and run.

The results of the test can be found in the following location:
\begin{verbatim}
${ESMF_DIR}/test/test${ESMF_BOPT}/${ESMF_ARCH}.${ESMF_COMPILER}.${ESMF_PREC}.${ESMF_SITE}
\end{verbatim}

For example, if your ESMF source files have been placed in your home directory:
\begin{verbatim}
       ~/esmf
\end{verbatim}

and your platform and compiler configuration is:
\begin{verbatim}
       Alpha multi-processor using the native compiler
\end{verbatim}

and you want to run an optimized version of system test SimpleCoupling,
then you use these commands from the directory {\tt \~/esmf}. 
\begin{verbatim}
       setenv ESMF_PROJECT <project_name>
       gmake ESMF_DIR=`pwd` SYSTEM_TEST=ESMF_SimpleCoupling system_tests
\end{verbatim}

If you are using ksh then replace the setenv command with
this:

\begin{verbatim}
       export ESMF_PROJECT=<project_name>
\end{verbatim}

The results will be in:
\begin{verbatim}
~/esmf/test/testO/OSF1.default.64.default/ESMF_SimpleCouplingSTest.stdout
\end{verbatim}

At the end of system test execution a script runs to analyze the results.

The script output indicates whether there are any system test failures.
The following is a sample from the script output:

\begin{verbatim}
The following is the analysis of the run system tests results:

Executable System Tests found:
-rwxrwxr-x   1 svasquez ncar          65283 Jul 01 10:17 ESMF_CompCreateSTest
-rwxrwxr-x   1 svasquez ncar          89959 Jul 01 10:36 ESMF_FieldHaloPerSTest
-rwxrwxr-x   1 svasquez ncar          76960 Jul 01 10:22 ESMF_FieldHaloSTest
-rwxrwxr-x   1 svasquez ncar          65768 Jul 01 10:39 ESMF_FieldRedistSTest
-rwxrwxr-x   1 svasquez ncar         108616 Jul 01 10:47 ESMF_FieldRegridConsrvSTest
-rwxrwxr-x   1 svasquez ncar         111276 Jul 01 10:41 ESMF_FieldRegridMultiSTest
-rwxrwxr-x   1 svasquez ncar         110447 Jul 01 10:44 ESMF_FieldRegridOrderSTest
-rwxrwxr-x   1 svasquez ncar         108411 Jul 01 10:33 ESMF_FieldRegridSTest
-rwxrwxr-x   1 svasquez ncar         112839 Jul 01 10:25 ESMF_FlowCompSTest
-rwxrwxr-x   1 svasquez ncar         162127 Jul 01 10:28 ESMF_FlowWithCouplingSTest
-rwxrwxr-x   1 svasquez ncar          62157 Jul 01 10:20 ESMF_RowReduceSTest
-rwxrwxr-x   1 svasquez ncar          95323 Jul 01 10:14 ESMF_SimpleCouplingSTest

All of the executable system tests should have a corresponding stdout file.
If not, it's an indication that the examples ere not executed, or that it failed to execute.

System Tests stdout files found: 
-rw-rw-r--   1 svasquez ncar          16359 Jul 01 12:43 ESMF_CompCreateSTest.stdout
-rw-rw-r--   1 svasquez ncar          50339 Jul 01 12:44 ESMF_FieldHaloPerSTest.stdout
-rw-rw-r--   1 svasquez ncar          23746 Jul 01 12:44 ESMF_FieldHaloSTest.stdout
-rw-rw-r--   1 svasquez ncar          12463 Jul 01 12:43 ESMF_FieldRedistSTest.stdout
-rw-rw-r--   1 svasquez ncar          19348 Jul 01 12:45 ESMF_FieldRegridConsrvSTest.stdout
-rw-rw-r--   1 svasquez ncar          15117 Jul 01 12:45 ESMF_FieldRegridMultiSTest.stdout
-rw-rw-r--   1 svasquez ncar          19321 Jul 01 12:45 ESMF_FieldRegridOrderSTest.stdout
-rw-rw-r--   1 svasquez ncar          19143 Jul 01 12:44 ESMF_FieldRegridSTest.stdout
-rw-rw-r--   1 svasquez ncar          10670 Jul 01 12:46 ESMF_FlowCompSTest.stdout
-rw-rw-r--   1 svasquez ncar           5174 Jul 01 12:48 ESMF_FlowWithCouplingSTest.stdout
-rw-rw-r--   1 svasquez ncar          12277 Jul 01 12:43 ESMF_RowReduceSTest.stdout
-rw-rw-r--   1 svasquez ncar         223944 Jul 01 12:45 ESMF_SimpleCouplingSTest.stdout

System Tests stdout files of zero length indicate that the test
did not run because it failed to compile or it failed to execute. 

The following tests passed: 
ESMF_CompCreateSTest.stdout
ESMF_FieldHaloPerSTest.stdout
ESMF_FieldHaloSTest.stdout
ESMF_FieldRedistSTest.stdout
ESMF_FieldRegridConsrvSTest.stdout
ESMF_FieldRegridMultiSTest.stdout
ESMF_FieldRegridOrderSTest.stdout
ESMF_FieldRegridSTest.stdout
ESMF_FlowCompSTest.stdout
ESMF_FlowWithCouplingSTest.stdout
ESMF_RowReduceSTest.stdout
ESMF_SimpleCouplingSTest.stdout


No system tests Failed.

\end{verbatim}

