% $ Id: $

Here we describe the requirements that apply to the whole body of 
ESMF software.  We adopt the standard requirements format described in 
the \htmladdnormallink{ESMF Software Developer's Guide}{http://www.esmf.ucar.edu/esmf\_docs/dev\_guide}.  The abbreviation used to identify
these General Requirements is {\bf GR}. The requirements
are drawn from the applications and user needs from ESMF project 
participants \cite{ESMFWEBSITE}, from community feedback and from background analysis carried out by the NASA
computational technologies group \cite{WOM2002}.

\req{Computational requirements}

\sreq{Language bindings}
ESMF software shall support the following language bindings:

\ssreq{Fortran 90 interface}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes except GFDL-HIM require F90 interfaces. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection (verification
  checklist will include array dimension information and 
  optional argument handling).
\end{reqlist}

\ssreq{C++ interface}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} GFDL-HIM. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection (verification
  checklist will include array dimension information and 
  optional argument handling).\\
{\bf Notes:} Handling of Try/Catch exception handling and 
error signal propogation over the C/C++ Fortran boundary 
will need to be addressed in the preliminary design and
implementation prototyping.
\end{reqlist}

\ssreq{C interface}
\begin{reqlist}
  {\bf Priority:} none \\
  {\bf Source:} GFDL-HIM. \\
  {\bf Status:} Rejected. \\
  {\bf Notes:} There will be a single interface serving C and C++
  applications. This C/C++ interface will be sufficient so the C only
  interface has been rejected.
\end{reqlist}

\sreq{Platforms}
The ESMF shall operate on the following platforms:

\ssreq{IBM SP}
\begin{reqlist}
{\bf Priority:} 1-approved. \\
{\bf Source:} NCAR, NCEP. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{SGI Origin}
\begin{reqlist}
{\bf Priority:} 1-approved. \\
{\bf Source:} GFDL, LANL, NCAR, DAO.  May be part of ESMF testbed system. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{Compaq ES}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} NSIPP, DAO.  May be part of ESMF testbed system. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{PC Linux platforms (including cluster)}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} MIT.  Required for optional cluster milestones. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{Sun-Solaris}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} NCAR. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\ssreq{Vector machines running Unix}
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} NCAR. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test and system test.
\end{reqlist}

\input{ESMF_buildreq}

\sreq{Performance} \label{perf}
Fully compliant adoption of the framework shall not increase the execution time 
of the milestone G codes, which are maintained and developed outside the 
framework throughout the project, by more than 10\% on scalar 
architectures within their scalable range.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for Milestone G. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Demonstrate with NCEP analysis and MITgcm ocean.
\end{reqlist}

\sreq{Precision} ESMF will provide methods for applications using
default integers and floating-point numbers at either 32-bit or 64-bit
precision.

\begin{reqlist}
  {\bf Priority:} 1. \\
  {\bf Source:} DAO, NCEP. \\
  {\bf Status:} Approved-1. \\
  {\bf Verification:} Interface inspection (verification 
  checklist will include array dimension information and
  optional argument handling) , code inspection, unit
  test, system test. \\
  {\bf Notes:}
  \begin{enumerate}
  \item While it is technically possible through overloading to allow
    argument lists to contain arbitrary combinations of 32-bit and
    64-bit quantities, this Requirement only calls for a uniform
    application-wide word length for integers and FP numbers to be
    supported.
  \item There may be individual operations within ESMF that explicitly
    call for transformations between 64-bit and 32-bit quantities.
    Those will appear as individual requirements.
  \end{enumerate}
\end{reqlist}

\sreq{Runtime configurability} The ESMF shall allow the user to set
certain application parameters at runtime.
\begin{reqlist}
{\bf Notes:} There are many runtime configurable parameters that 
need to be set for codes operating as framework components.
The sub-requiremente listed here \ref{req:gr:Configurable_decomposition} - 
\ref{req:gr:Configurable_paths_and_directories} are some, but not all of these.
\end{reqlist}

\ssreq{Configurable decomposition} ESMF shall allow domain
decomposition and assignment of domains to processors, nodes, and/or
threads to be configurable at runtime.  The choice of parallelization
mechanism (message passing/multithreading/combination) must be
configurable at runtime.
\label{req:gr:Configurable_decomposition}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} CAM-EUL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Configurable resolution}
ESMF shall allow model resolution to be configurable at runtime.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} all codes. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Configurable paths and directories}
ESMF shall allow input and output paths and directories to be specified
at runtime.
\label{req:gr:Configurable_paths_and_directories}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} all codes. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.
\end{reqlist}

\sreq{Bit-reproducibility}

Bitwise identical results between two runs is an important feature for
deterministic execution, as well as for debugging and maintenance.
This is not possible to enforce across platforms, at different levels
of compiler optimization, or even different versions of the same
compiler. Within these constraints, ESMF shall provide varied levels
of bit-reproducibility:

\ssreq{Parallel bit-reproducibility}

An execution mode will be provided which allows an ESMF-based model to
return bitwise identical results from the same executable at different
processor counts, or different parallelism options. This execution
mode is not subject to the performance requirement of Section~\ref{perf}.

\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} all JMC codes. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Bit-reproducibility on identical configurations}

The \emph{default} execution mode will allow an ESMF-based model to
return bitwise identical results from the same executable at the same
processor count, with the same parallelism options. This mode
\emph{is} subject to the performance requirement of
Section~\ref{perf}.

\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} all codes. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} System test.
\end{reqlist}

\ssreq{Non bit-reproducing fast option}

If a performance enhancement may be had by waiving the default
requirement above, this will be made available in a special execution
mode. In this mode, even two runs at the same processor count, with
the same parallelism options, may not return bitwise identical
results.

\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} NCEP, HIM. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} System test.
\end{reqlist}

\sreq{Error handling}
The ESMF shall be instrumented for error handling consistly across the
framework.  The user shall receive ample information on errors including
comprehensive error logging.
\label{req:gr:error_handling}
\begin{reqlist}
  {\bf Priority:} 1. \\
  {\bf Source:} Required by all codes. \\
  {\bf Status:} Approved-1. \\
  {\bf Verification:} Interface inspection (verification
  checklist will include array dimension information and 
  optional argument handling), code inspection, unit
  test, system test.
  {\bf Notes} Components will be required to use ESMF error
handling utilities for fatal erros to be classified as 
{\it well-behaved} ESMF components.
\end{reqlist}

\ssreq{Parallel race-condition error handling}
Error handling code to detect race-conditions and other problems associated 
with parallelism shall be included.
\label{req:gr:error_handling}
\begin{reqlist}
  {\bf Priority:} 1. \\
  {\bf Source:} Required by all codes. \\
  {\bf Status:} Approved-1. \\
  {\bf Verification:} System test.
  {\bf Notes} This could be achieved through assertions and ordering/bookeeping
counters on messaging on communication operations.
\end{reqlist}

\ssreq{Debug mode for component comparison}
It shall be possible to run two instances of a component instrumented 
with debug directives and compare results on the fly.  When 
the results are the same no messages are produced; when they differ
informative messages are generated.
\begin{reqlist}
  {\bf Priority:} 2. \\
  {\bf Source:} Generated by NOAA FSL, desired by GFDL. \\
  {\bf Status:} Approved-2. \\
  {\bf Verification:} System test.
  {\bf Notes} See community requirements number 1003.
\end{reqlist}

\sreq{Modularity}
Layers of the framework will be designed to adapt to restructuring of
other parts of the framework and user-supplied components.  For
example, the coupling layers should be able to adapt to different
implementations and data structures of component models.
A modular design and implementation approach must be used that ensures
parts of the framework are independent of one another and can be 
developed concurrently.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for interoperability Milestones I and J. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interoperability experiments and incremental
adoption demonstrations by deployment teams.\\
{\bf Notes:} Good encapsulation, modular design and clean interfaces are critical to the
maintenance of models built with the framework. Framework classes, modules and algorithms must be
easy to adapt to take advantage of new techniques that are developed
by the Earth science community and added to the framework.
\end{reqlist}

\sreq{Extensibility} The ESMF framework must allow extensions both
for core suppport capabilities and through plug-in components.
Framework classes, modules and algorithms must be easily extensible
to allow additional functionality to be added for supporting new components
like atmospheric chemistry, carbon cycle, etc...
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-2. \\
{\bf Verification:} Milestone demonstrations of migration
of more than twelve major applications and six styles of gridding.\\
{\bf Notes:} It is important that appropriate abstract interfaces and polymorphic 
methods are used to ensure adding new methods, grids, algorithms and data structures
can be easily done. This will facilitate building new types of models that are not
currently available.
\end{reqlist}

\sreq{Flexibility} The ESMF framework will be flexible and will
be suited to a wide range of Earth science applications and a broad span
of target hardware. Framework classes, modules and algorithms must be flexible and
provide options to support both efficiency and accuracy.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Milestone demonstrations of migration
of more than twelve major applications on several different
platforms covering a wide variety of science scenarios
that span research to operational forecasting.
\end{reqlist}

\sreq{Documentation} An exhaustive collection of documentation
to support ongoing evolution of ESMF is required. The framework must be 
fully documented, easily understandable and well supported.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Compliance with software developers guide.
{\bf Notes:} The Software Developers Guide specifies a suite of documents 
that will be produced.
\end{reqlist}

\sreq{Systematic build, test, packaging} A systematic scheme for disseminating
stable, versioned software and for gathering and tracking defects is required.
The framework should be delivered to developers using the standard packaging
utility for the supported platforms.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Compliance with software developers guide.
{\bf Notes:} The Software Developers Guide specifies a versioning
schemes that will be used, release schedules and mechanisms for monitoring
and managing product quality.
\end{reqlist}

\sreq{Compatability with batch execution}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Milestone demonstrations.\\
{\bf Notes:} In this mode, all input and output data are read and stored
directly from file. This will be the standard mode of operations used by
many ESMF applications.
\end{reqlist}

\sreq{Compatability with interactive execution}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Milestone demonstrations.\\
{\bf Notes} This mode allows rapid testing of new features and debugging.
A trace mode which allows program excution to be logges in detail,
but at the expense of reduved performance, is useful in this mode.
Future extensions could include elements of computatinal steering
in which program progress can be monitored and directed
interactively.
\end{reqlist}

\sreq{Compatability with ensemble methods}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Milestone demonstrations.\\
{\bf Notes:} Ensemble methods require multiple instances of
the same base component, generally with slight parametric variations.
The ability to spawn numerous ensembles and then collect together
results for automated processing, such as covariance calculation, 
is a basic requirement. A general mix of concurrent and sequential ensemble 
member execution must be supported.
\end{reqlist}

\sreq{Compatability with multi-institution, multi-component simulations}
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All codes\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Milestone demonstrations.\\
{\bf Notes:} Some form of component versioning, labeling and naming
is required that enables experiment configuration logs
to include information of which components were used.
\end{reqlist}

\sreq{Ease of adoption}
It must be straightforward to integrate ESMF into an application 
that is reasonably modular. Adapting an existing modular application
to use the frameworks coupling services shall require no more
than 2\% modification of the applications source code.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} GFDL, NSIPP. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Line count.
\end{reqlist}

\req{Maintenance and support requirement}
The ESMF must be maintained as a long-term commitment by at least one
institution.  This maintenance must extend beyond adaptation to the 
computational environment, and must include an ongoing research component
dedicated to increasing the performance, flexibility and functionality of
the software.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All participants. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Publicly documented commitment, line item in 
projected budgets.
\end{reqlist}


\req{Integrated resource monitoring and tracking}
The ESMF shall be instrumented to allow resource utilization
to be tracked and monitored.
\label{req:gr:error_handling}
\begin{reqlist}
  {\bf Priority:} 1. \\
  {\bf Source:} Required by all codes. \\
  {\bf Status:} Approved-1. \\
  {\bf Verification:} Unit test, system test.
\end{reqlist}





