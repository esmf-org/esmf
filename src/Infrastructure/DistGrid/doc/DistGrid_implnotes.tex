% $Id: DistGrid_implnotes.tex,v 1.6 2005/10/21 20:27:51 jwolfe Exp $

%\subsection{Implementation Notes}

The DistGrid class contains the mapping between the DE-local grid decompositions
and the global logical Grid.  It contains methods to synchronize data values
between the boundaries of subsets, and to collect and communicate global data
values.  It interacts closely with the PhysGrid object.

\begin{enumerate}

\item {\bf DistGrid Internal Classes}
\label{sec:DistGridClasses}

The DistGrid class contains the DELayout class as well as two private
subclasses, the DistGridGlobal and DistGridLocal classes.  The separation
between DistGridGlobal and DistGridLocal allows the code to clearly differentiate
between functions which operate internal to a single DE on a local
decomposition of data, and those which must be aware of the global state of the
distribution.

\begin{itemize}
\item {\bf DELayout} The DELayout class is described in detail in the Utilities
section of this document.
\item {\bf DistGridGlobal} The DistGridGlobal class contains general information
about each of the partitions that the entire Grid has been decomposed into. This
includes information about how each part relates to the whole, how many
points/cells there are per decomposition, etc.  This information allows DistGrid
to compute information about DEs on other PETs without having to do communication
first.

\item {\bf DistGridLocal} The DistGridLocal class contains detailed subGrid
information for the data located on this DE, such as the DE-local cell count and
the number of cells along each axis and their position in the global Grid.  When
we implement multiple DEs per PET, then we will have a list of these instead of
a single one in the DistGrid class.
\end{itemize}

\item {\bf DE-Local verses Global Data}

The primary purpose of DistGrid is to encapsulate information about the local
decomposition(s) (DE) of the Grid on this PET.  This includes such information
as the total number of this DE's local (or DE-local) cells, if logically
rectangular the numbers of cells along each dimension, and the location of this
DE-local data in the global {\tt ESMF\_Grid}.  The minimum information required
would be to compute and store data only for the local DE.

However, at create time DistGrid computes information not only about the
local decomposition, but also less detailed information about the other
decompositions for the entire Grid.  While this duplicates some data, it
avoids communication when a DE on one PET requires information that would
otherwise require sending data to or receiving data from DEs on other PETs. 

\item {\bf Boundary Cells}

As part of the create-time computation DistGrid computes sizes and lengths
for the DE-local grid cells, and also does a secondary computation 
of sizes and lengths taking into account a layer of boundary cells around 
each DE.  These boundary cells are distinct from the halo cells which are
specified on a per-Field basis and are visible to the user code.

The boundary cells inside DistGrid are only used internally to the Framework,
for example during regridding, to avoid unnecessary inter-PET communication and
to handle exterior boundaries in a consistent manner.

\end{enumerate}





Some methods which have a DistGrid interface will actually be
implemented at the underlying DELayout or Array level; they
will be inherited by the DistGrid class.  This allows the user
API to present functions at the level which is most consistent to the
application without restricting the actual implementation.


The DistGrid class has two instances of both DistGridLocal and
DistGridGlobal classes.  One represents the computational domain, which is the
part of the Grid this DE is responsible for computing on, and one represents
the total domain, which includes halo and ghost cells as well as computational
cells.





