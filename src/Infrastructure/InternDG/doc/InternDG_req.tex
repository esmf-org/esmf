% $Id: InternDG_req.tex,v 1.3.2.3 2010/02/01 20:51:10 svasquez Exp $
%
% Earth System Modeling Framework
% Copyright 2002-2010, University Corporation for Atmospheric Research,
% Massachusetts Institute of Technology, Geophysical Fluid Dynamics
% Laboratory, University of Michigan, National Centers for Environmental
% Prediction, Los Alamos National Laboratory, Argonne National Laboratory,
% NASA Goddard Space Flight Center.
% Licensed under the University of Illinois-NCSA License.

%===============================================================================

This part covers all the requirements for defining, querying and
relating grid distributions or domain decompositions. The PEList and
the global domain are assumed retrievable (from \textbf{Control} and
\textbf{GriddedComponent} respectively). Here we set down requirements
that apply to all grids. The requirements specific to certain grid
types follow in Part~\ref{DG:gridtypes}.

\req{Grid definition}

\sreq{Generation of a layout}

Given a global domain and a PEList, there will be methods to derive an
appropriate layout of PEs in multiple dimensions.

\begin{reqlist}
{\bf Priority:} 1\\
{\bf Source:} Required by everyone. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\ssreq{Subdivide a layout}

Subdivide a layout.  All distributed grid operations shall work 
on such a sub-layout.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} Required by NCEP-SSI, MIT, GFDL. \\
{\bf Status:} Redundant: covered by spawning of PELists. \\
{\bf Verification:} Unit test.
\end{reqlist}

\sreq{User-specified layout}

It will be possible to override the internally generated layout above
by direct user specification.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} Required or desired by everyone. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\ssreq{1D decomposition}

ESMF permits 1D domain decomposition, i.e. the distribution of a
(possibly multidimensional) array over a 1D layout.

\begin{reqlist}
{\bf Priority:} 1.\\ 
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, NCEP-GSM, NCEP-SSI, MIT, WRF, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} probably can be treated as a special case of 2D with no
  loss of generality or performance.
\end{reqlist}

\ssreq{Index order}

1D domain decomposition may apply to any of the three spatial
dimensions, on data arrays specified in any index order (XYZ, XZY,
etc).

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} Get detailed list of sources here for different index
  orders: full generality is potentially a lot of work. \\
 CAM-FV: (XY, XYZ, XZY).  Consistently decomposed blockwise in Y. \\
 CCSM-CPL: (XY) \\
 NCEP-GSM: spectral (YXZ) decomposed cyclically on X;
           grid (XZY) decomposed cyclically on Y \\
 NCEP-SSI: spectral (background error) (T,YX,ZT) decomposed on X;
           spectral (transform) (T,YX,ZT) decomposed on ZT;
           grid (transform) (T,Y,X,ZT) decomposed on ZT;
           ungridded obs (T,YX,ZT) decomposed variable blocked on YX \\
 MIT: (XYZ) blocked along X or Y. \\
 WRF: (XY, YX, XYZ, YZX, XZY, ZXY) \\
 GFDL: X, Y \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:}  In CAM-FV dynamics, 4D tracer areas are XYZT or
        possibly XZTY, where T is the tracer dimension.  In the physics
        there are cases of T in the second dimension.  The CAM
        chunking mechanism brings up several additional indexing
        orders (needs to be documented by other teams) \\
        In the NCEP-SSI, tracers (T) are split into 2 different
        dimensions.

        Optimization for arbitrary index orders not available by year 1.
\end{reqlist}

\ssreq{2D decomposition}

ESMF permits 2D domain decomposition, i.e. the distribution of a
(2- or more dimensional) array over a 2D layout.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, WRF, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Should NOT be treated as a special case of 3D!
        CAM-FV has been extended for 2D decomposition, but 
        it is not used by default.
        A region concept is required e.g. decomp. could
        be blocked in X and Y and regions. Regions are always
        separated tiles.
\end{reqlist}

\ssreq{Index order}

2D domain decomposition may apply to any two of the three spatial
dimensions, on data arrays specified in any index order (XYZ, XZY,
etc).

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} Get detailed list of sources here for different index
  orders: full generality is potentially a lot of work. \\
  CAM-FV  (XYZ, XZY, XYZT, perhaps XZTY, others for chunked physics);
  The decomposition is blockwise in X-Y for physics and blockwise in 
  Y-Z for dynamics.  \\
  CCSM-CPL: (XY) \\
  POP (XY), CICE (XY) \\
  NCEP-GSM: spectral (semi-implicit) (ZYX) decomposed blocked on Y and X; 
            spectral (transform) (YXZ) decomposed cyclically on X and blocked on Z;
            grid (transform) (XYZ) decomposed cyclicaly on Y and blocked on Z; 
            grid (physics) (ZXY) decomposed cyclicaly on X and Y. \\
  NCEP-SSI: grid (T,Y,X,ZT) decomposed variable blocked on Y and X \\
  MIT: XYZ blocked in X, Y or XY, variable sizes and holes \\
  WRF: (XY, YX, XYZ, YZX, XZY, ZXY) \\
  GFDL: XY
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.

        Optimization for arbitrary index orders not available by year 1.
\end{reqlist}

\ssreq{1D distributed arrays associated with a 2D decomposition}

Within a 2D decomposition, it must be possible for arrays to be
distributed along a single axis of distribution.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} Required by CAM-FV (2D decomposition), NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, MIT, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} \\
{\bf Notes:} i.e given a 2D decompsition in \texttt{(i,j)}, it must be
  possible to have arrays that are functions of \texttt{(i,j)},
  \texttt{(i,j,k)}, etc but also \emph{(j,k)}.  CAM-FV: needed for
  2D decomposition, which not the default.
\end{reqlist}

\sreq{3D decomposition}

ESMF permits 3D domain decomposition, i.e. the distribution of a
(3- or more dimensional) array over a 3D layout.

\begin{reqlist}
{\bf Priority:} \\
{\bf Source:} \\
{\bf Status:} Rejected. \\
{\bf Verification:} \\
{\bf Notes:} The SWMF is working with 3D decompositions; we plan to
work with them about aligning their formalism to ours.
\end{reqlist}

\sreq{Generation of domain decomposition}

Given a global domain and a layout, there will be methods to assign
all points in the domain to one PE for computation. 

\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:} Requirements for specific flags to control the
  decomposition must be added here. CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} \\
{\bf Notes:} In multi-threaded applications, the PE assignment is done
  only for each ``MPI process''. Additional threaded PEs work on
  partitions within these computational domains.
  
  The partitions do not necessarily have a PE associated with it. The
  partitions may define a task queue from which PEs assigned to
  threads pop tasks. The pool of PEs available for threading is drawn
  from the associated PE list, of which not all are part of the layout.
  
  Threads can be mapped on to an addressable node, which can 
  consist of multiple
  PEs.  The main thing I'm trying to arrive at is that the
  partitioning into threads is independent of assignment to PEs.
  Principally, one must be able to define an arbitrary number of
  partitions organized into a queue, off which shared-memory execution
  threads can pop tasks as resources get freed. - VB

  Thread partitioning (and all PEs) should be included in the layout 
  and not a separate partitioning specification.  This will make
  queries simpler and the programming interface across a variety 
  of machines more consistent. - CMD.
\end{reqlist}

\sreq{User-specified domain decomposition}

It will be possible to override the internally generated 
domain decomposition above by direct user specification of domain
extents.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, WRF, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} WS:  there will there be a fairly wide spectrum 
of decomposition create methods, with varying degrees of user
specification, e.g. less specific ``distributed a 3-D XYZ array 
over a 2-D layout in a block-cyclic manner''), or more 
user-specified (``map the global domain to the following PE 
and local indices''). Standard ones will probably appear first, and
fully user-controlled ones later.
\end{reqlist}

\sreq{Computational domain masks} \label{DG:masklayout}

It shall be possible to mask domains from the computation: i.e
generate a domain decomposition where one or more exclusive
domains are assigned to no PE.

\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:} POP, CICE, MIT, GFDL. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Very useful in an ocean model when a decomposition
  of the sphere yields entire exclusive domains containing only
  land points.

  Not the same mask as in Req.~\ref{DG:masksum}.
\end{reqlist}

\sreq{Generation of grid topology}

Given the data dependencies of the numerics, ESMF will be capable of
computing the connectivities required for data sharing and
synchronization of exclusive domains across a distributed grid.


\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\sreq{Validity of grid topology}

Given a data dependency specification, ESMF will be capable of
asserting whether or not a given distributed grid topology is
conformant with that pattern.

\begin{reqlist}
{\bf Priority:} 2. \\ 
{\bf Source:} Required by MIT, GFDL. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test for specific cases.\\
{\bf Notes:} e.g if you initialize with halo=2, and later decide to
add a 25-point stencil, you should be able to check that your grid
topology is insufficient.
\end{reqlist}

\sreq{Periodic boundary conditions}

ESMF will treat periodic boundary conditions along any spatial axis as
a particular kind of topological feature. It will be possible to
specify this as input information for grid topology generation.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, CAM-EUL, CLM, CCSM-CPL, POP, CICE, MIT, WRF, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test, code inspection. \\
{\bf Notes:} It is natural to treat this as a distributed grid
  feature, rather than having separate edge detection code in
  applications. There is more than one way to treat lateral boundary
  conditions (LBCs) in a
  distributed grid: these will be spelt out anon.
\end{reqlist}

\req{Grid information retrieval}

\sreq{Exclusive domain retrieval}

\ssreq{Domain extents}

It shall be possible to retrieve the size of a exclusive domain
along each axis of decomposition.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, WRF, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\ssreq{Domain begin and end indices}

It shall be possible to retrieve the beginning and ending indices of 
an exclusive domain along each axis of decomposition.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, CICE, MIT, WRF, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\ssreq{Domain index list}

It shall be possible to retrieve the full index list of 
an exclusive domain along each axis of decomposition.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} NCEP-GSM, NCEP-SSI, MIT, GFDL. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test.\\
{\bf Notes:} For non-contiguous decompositions.
\end{reqlist}

\ssreq{Maximum domain extent}

It shall be possible to retrieve the maximum size along each axis of
decomposition of all the exclusive domains in the distributed grid. 

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-EUL, CAM-FV, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\ssreq{Exclusive domain list}

ESMF methods will be provided to retrieve the list of exclusive
domains associated with each PE of a distributed grid.

\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:} CCSM-CPL, POP, MIT, GFDL \\
{\bf Status:} Approved-2. \\
{\bf Verification:} \\
{\bf Notes:} Besides being able to retrieve one's own domain
  information, the full list of domains is also required for certain
  operations.
\end{reqlist}

\sreq{Local domain retrieval}

\ssreq{Domain extents}

It shall be possible to retrieve the size of a local domain
along each axis of decomposition.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, WRF, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\ssreq{Domain begin and end indices}

It shall be possible to retrieve the beginning and ending indices of a
local domain along each axis of decomposition.

\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required by CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, CICE, MIT, WRF, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\ssreq{Domain index list}

It shall be possible to retrieve the full index list of a
local domain along each axis of decomposition.

\begin{reqlist}
{\bf Priority:} 2. \\ 
{\bf Source:} Required by NCEP-GSM, NCEP-SSI. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test.
{\bf Notes:} This is interpreted (with the 2 preceding requirements) as
a specific requirement for unstructured distributed grid points.  (CNH, RWH, VB)
\end{reqlist}

\ssreq{Maximum domain extent}

It shall be possible to retrieve the maximum size along each axis of
decomposition of all the local domains in the distributed grid. 

\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required by CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\ssreq{Index translation for globally non-conformant local domains}

Where the local array allocation is not globally-conformant, 
ESMF will have methods to translate the local indices to
globally-conformant indices.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} POP, CICE, MIT (desired). \\
{\bf Status:} Approved-1. \\
{\bf Verification:} \\
{\bf Notes:} It is possible (using array lower bound specifications)
  to generate a \emph{globally conformant} array allocation: such that
  if Madras is point (80,13) in the global grid, it will be (80,13) on
  the local domain of any decomposition. Where this is not done, there
  must be methods to translate local indices to globally conformant
  indices.  CAM-FV should be globally conformant. 
  This would be a useful option, but its not
  required by current MIT code - CNH.
\end{reqlist}

\ssreq{Local domain list}

ESMF methods will be provided to retrieve the list of local
domains associated with each PE of a distributed grid.

\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:} CCSM-CPL, POP, CICE, MIT, GFDL. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} \\
{\bf Notes:} Besides being able to retrieve one's own domain
  information, the full list of domains is also required for certain
  operations.
\end{reqlist}

\sreq{Memory domain retrieval}

\ssreq{Domain extents}

It shall be possible to retrieve the size of a memory domain
along each axis of decomposition.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, WRF, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\ssreq{Domain begin and end indices}

It shall be possible to retrieve the beginning and ending indices of a
memory domain along each axis of decomposition.

\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required by CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, CICE, MIT, WRF, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\ssreq{Domain index list}

It shall be possible to retrieve the full index list of a
memory domain along each axis of decomposition.

\begin{reqlist}
{\bf Priority:} 2. \\ 
{\bf Source:} Required by NCEP-GSM, NCEP-SSI. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test.
\end{reqlist}

\ssreq{Maximum domain extent}

It shall be possible to retrieve the maximum size along each axis of
decomposition of all the memory domains in the distributed grid. 

\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required by CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\ssreq{Memory domain list}

ESMF methods will be provided to retrieve the list of memory
domains associated with each PE of a distributed grid.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CCSM-CPL, POP, CICE, MIT, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} \\
{\bf Notes:} Besides being able to retrieve one's own domain
  information, the full list of domains is also required for certain
  operations.
\end{reqlist}

\sreq{Global domain retrieval}

\ssreq{Domain extents}

It shall be possible to retrieve the size of a global domain
along each axis of decomposition.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, WRF, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.\\
{\bf Notes:} CAM-FV: the size of the global domain is known
a priori and does not need to be retrieved.
\end{reqlist}

\ssreq{Domain begin and end indices}

It shall be possible to retrieve the beginning and ending indices of the
global domain along each axis of decomposition.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CCSM-CPL, POP, CIC, MIT, WRF, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} CAM-FV: the size of the global domain begin and end
indices are known a priori and does not need to be retrieved.
\end{reqlist}

\sreq{DELayout retrieval}

ESMF methods will be provided to publish and retrieve the layout
associated with a distributed grid.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CCSM-CPL, GFDL, MIT. \\
{\bf Status:} Redundant: built into PELists. \\
{\bf Verification:} Unit test.
\end{reqlist}

\sreq{Grid topology retrieval}

ESMF methods will be provided to retrieve the network of
connectivities established by the data dependency patterns of the
distributed grid.

\begin{reqlist}
{\bf Priority:} 3 \\
{\bf Source:} CCSM-CPL, GFDL, MIT \\
{\bf Status:}Redundant: built into PELists.  \\
{\bf Verification:} Unit test.\\
{\bf Notes:}
\end{reqlist}

\sreq{Which PE is a point on?}

ESMF methods will be provided to query the PE associated with (i.e
``owning'' the exclusive domain containing) any point in a
distributed grid.

\begin{reqlist}
{\bf Priority:} 2 \\ 
{\bf Source:} CCSM-CPL, POP, MIT, WRF, GFDL \\
{\bf Status:} Approved-2. \\
{\bf Verification:} \\
{\bf Notes:} It is not required that the mapping to local indices be
highly efficient: this is not usually an ``inner-loop'' type operation.
\end{reqlist}

\sreq{Cross-component queries}

It shall be possible to retrieve a \textbf{DistGrid} associated with
any component in an ESMF application in a form that permits all the query
operations listed above.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CCSM-CPL, MIT, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:}
\end{reqlist}

\req{Grid relations}

\sreq{Equality of global domains}

It shall be possible to state if two distributed grids share the same
global domain.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, CICE, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\sreq{Equality of domain decomposition}

It shall be possible to state if two distributed grids sharing a
global domain are identically decomposed.

\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:} CCSM-CPL, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\sreq{Equality of PE assignment}

It shall be possible to state if two distributed grids with identical
domain decompositions assign their exclusive domains to the
identical sequence of PEs.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CCSM-CPL, POP, CICE, MIT, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\req{Halo update} \label{DG:halo}


\sreq{Unblocked halo update}

ESMF shall provide an unblocked halo update: where the underlying
data transfer may not be complete when the call returns.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, NSIPP, NCEP-SSI, MIT, WRF, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} \\
{\bf Notes:}
\end{reqlist}

\sreq{Blocked halo update}

ESMF shall provide a blocked halo update: where the underlying
data transfer is complete when the call returns.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} CAM-EUL, CLM, CCSM-CPL, POP, CICE, MIT, WRF, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.\\
{\bf Notes:}
\end{reqlist}

\sreq{Wait for completion}

ESMF shall provide a method to wait for the completion of a previously
issued unblocked halo update.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, NCEP-SSI, MIT, WRF, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\sreq{Validation and invalidation of halo points}

ESMF shall provide methods to declare halo points valid or invalid
(i.e requiring a halo update prior to use).

\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:} POP (desired), CICE (desired), MIT (desired), GFDL (required). \\
{\bf Status:} Approved-2. \\
{\bf Verification:} \\
{\bf Notes:} This feature can be used to detect when to perform a halo
  update. This may also be used to reduce the frequency of halo
  updates on high-latency networks, by declaring wide halos and
  performing redundant computations within them. See \cite{ref:b2001}
  for details. Partial updates may not necessarily support
  arbitrary lists of halo points, but the following are useful:
  \begin{itemize}
  \item ``Update N and E halos only, including the NE corner.''
  \item ``Update only 1 row/column in each direction even if the halo
    width is 2''.
  \item `Update only the outer row/column of a 2-width halo.''
  \end{itemize}
\end{reqlist}

\sreq{Adjoint of halo update}
A "transpose" form (in the mathematical sense of the word) is required
for all the permutations that a halo can perform.
\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:}  MIT, GFDL. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test.
{\bf Notes:} Needed for Part III MIT/GCM milestones.
\end{reqlist}

\req{Data transpose} \label{DG:transpose}

\sreq{Unblocked data transpose}

ESMF shall provide an unblocked data transpose: where the underlying
data transfer may not be complete when the call returns.

\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:} CAM-FV (2D decomposition), NSIPP, NCEP-GSM, NCEP-SSI, MIT, WRF, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} \\
{\bf Notes:} Maybe we're pre-empting design issues, but I'd want
  issues like wait-for-completion dealt with within distributed grids.
\end{reqlist}

\sreq{Blocked data transpose}

ESMF shall provide a blocked data transpose: where the underlying
data transfer is complete when the call returns.

\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required by CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, WRF, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} \\
{\bf Notes:} Doesn't necessarily need separate call, same as unblocked
  + wait-for-completion.
\end{reqlist}

\sreq{Wait for completion}

ESMF shall provide a method to wait for the completion of a previously
issued unblocked data transpose.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV (2D decomposition), NSIPP, NCEP-GSM, NCEP-SSI, MIT, WRF, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\sreq{Adjoint of data transpose}
A "transpose" form (in the mathematical sense of the word) is required
for all the permutations that a data transpose can perform.
\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:}  MIT \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Needed for milestone.
\end{reqlist}

\req{Gather}

It shall be possible to create a copy on any PE of the entire global
array from a distributed array.

\begin{reqlist}
{\bf Priority:} 1 \\  
{\bf Source:} All \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} it is up to the user to verify that there is enough
memory available to hold a copy of the global array.
\end{reqlist}

\sreq{Allgather}

It shall be possible to create a copy on all PEs of the associated
PEList of the entire global array from a distributed array.

\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, NCEP-GSM, NCEP-SSI, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} It is up to the user to verify that there is enough
memory available to hold a copy of the global array.
\end{reqlist}

\sreq{Partial gather} \label{DG:PartGather}

In a multi-dimensional decomposition, it shall be possible to perform
a gather along any specified axis.

\begin{reqlist}
{\bf Priority:} 2 \\ 
{\bf Source:} CAM-FV (2D decomposition), POP, MIT, GFDL \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\sreq{Adjoint of gather}
A "transpose" form (in the mathematical sense of the word) is required
for the matrix operator a gather represents.
\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:}  MIT \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Needed for a milestone.
\end{reqlist}

\req{Scatter}

It shall be possible to create a distributed array across a PE list
from a copy on any PE of the entire global array.

\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:} All\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} all the scatter requirements may have an optional flag
that allows halos to be filled in during the scatter.
\end{reqlist}

\sreq{Partial scatter}

In a multi-dimensional decomposition, it shall be possible to perform
a scatter along any specified axis.

\begin{reqlist}
{\bf Priority:} 2 \\ 
{\bf Source:} CAM-FV (2D decomposition), NSIPP. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\sreq{Adjoint of scatter}
A "transpose" form (in the mathematical sense of the word) is required
for the matrix operator a scatter represents.
\begin{reqlist}
{\bf Priority:} \\ 
{\bf Source:} \\
{\bf Status:} Deferred. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} not needed for MIT milestones.
\end{reqlist}

\req{Broadcast}

It shall be possible to broadcast data to all PEs in the domain decomposition.

\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:} NCEP-SSI, MIT, GFDL. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Needed for milestone.
\end{reqlist}

\sreq{Adjoint of broadcast}
A "transpose" form (in the mathematical sense of the word) is required
for the matrix operator a broadcast represents.
\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:}  MIT. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Needed for milestone.
\end{reqlist}

\req{Bundling}

ESMF shall provide a method to bundle multiple data arrays on the same
distribution for aggregate data transfer.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, WRF, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Note that all arrays in a bundle must share the same
  distribution, that's the only case where aggregate data transfer
  methods may be simple and efficient.
  
  Bundling methods with similar requirements may appear in other
  documents (e.g \textbf{Fields}, \textbf{Regrid}, \textbf{Physical Grids}),
  but the methods there will likely cascade to here, as the main
  utility of bundles lies in aggregate data transfer methods on
  distributed grids. The other documents should derive an equivalent
  list of methods listing the ones here as source.

WRF: Should the bundling have to be specified by the application?  Allow this as a hint that app can provide ESMF.

We need to work to clarify the concept of a bundle throughout this doc -
right now it's pretty confusing - CMD.

We shall work at matching these requirements on data array bundles to
cascade exactly from the field bundle requirements. -vb
\end{reqlist}

\sreq{Initiate a bundle}

It must be possible to initiate any number of instances of a bundle on
a distributed grid.

\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:} CAM-FV, CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\sreq{Add an array}

It must be possible to add any array on a conformant distributed grid
to a bundle.

\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:} CAM-FV, POP, MIT, GFDL. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Mix-and-match data types allowed? Could be tricky... if
  array elements have differing byte lengths.
\end{reqlist}

\sreq{Delete an array}

It must be possible to delete any array from a bundle.

\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:} CCSM-CPL, MIT. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\sreq{Merge bundles}

It must be possible to merge bundles sharing a distributed grid.

\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:} CCSM-CPL, MIT, GFDL. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Two bundles on different distributed grids may end up on the same
  one after a data transpose.  
\end{reqlist}

\req{Global reduction operations}

\sreq{Integer global sum}

ESMF shall provide methods to compute the global sum of a distributed
integer array.

\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, CICE, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}


\sreq{FP and complex global sum}

ESMF shall provide methods to compute the global sum of a distributed
floating-point or complex array.

\begin{reqlist}
{\bf Priority:} 1 \\ 
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\ssreq{FP and complex global sum under a mask} \label{DG:masksum}

ESMF shall provide methods to compute the global sum of a 2D-decomposed
floating-point or complex array under control of a mask. The mask
omits an arbitrary list of array locations from the sum.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} POP, CICE, MIT, GFDL \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Not the same mask as in Req.~\ref{DG:masklayout}.
\end{reqlist}

\ssreq{FP and complex global sum along one axis}

ESMF shall provide methods to compute the global sum of a 2D-decomposed
floating-point or complex array along either axis of decomposition.

\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, MIT, GFDL \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Required for computing zonal means.
\end{reqlist}

\ssreq{FP and complex bit-reproducible global sum}

ESMF shall provide methods to compute the global sum of a
2D-decomposed floating-point or complex array where the result is
bitwise identical on different decompositions.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} Trace to GR. CAM-EUL, CLM, NCEP-GSM, NCEP-SSI, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Runtime selectable.
\end{reqlist}

\sreq{FP and complex global checksum}

ESMF shall provide methods to compute the global checksum of a
distributed floating-point or complex array. 

\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:} MIT (desired), GFDL \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} A checksum is different from a sum in that there is no
  data loss when the data has a dynamic range exceeding the FP or
  complex precision. It is done by casting all FP numbers as integers
  before summing.
\end{reqlist}

\sreq{Adjoints of all sums except checksum are required}

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} MIT \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} needed for milestone.
\end{reqlist}

\sreq{Global maximum of integer or FP data}

ESMF shall provide methods to compute the global maximum of a
distributed integer or FP array.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}


\ssreq{Location of global maximum}

The location of this maximum on the distributed grid is also
retrievable.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}


\sreq{Global minimum of integer or FP data}

ESMF shall provide methods to compute the global minimum of a
distributed integer or FP array.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}


\ssreq{Location of global minimum}

The location of this minimum on the distributed grid is also
retrievable.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, NSIPP, CAM-EUL, CLM, CCSM-CPL, POP, CICE, NCEP-GSM, NCEP-SSI, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\req{Blocked and unblocked collectives}

It shall be possible to perform gather, scatter, broadcast, and reduction in both blocked and unblocked forms.

\begin{reqlist}
{\bf Priority:} 1\\ 
{\bf Source:} NCEP-SSI, MIT, GFDL. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\req{Grid staggering}

There are many possible ways to specify staggered grids.  Currently
grid staggering is only required for logically rectilinear grids. We
use the notation of \cite{ref:a1966} to specify staggering (e.g. A-,
B-, C- and D-grids) together with a directional qualifier, e.g
\texttt{NE} to specify a forward index offset in \texttt{X} and
\texttt{Y}.

\newcommand{\agrid}{\texttt{AGRID~}}
\newcommand{\bgrid}{\texttt{BGRID~}}
\newcommand{\cgrid}{\texttt{CGRID~}}
\newcommand{\dgrid}{\texttt{DGRID~}}
%added by WRF
\newcommand{\egrid}{\texttt{EGRID~}}

\sreq{\agrid}

ESMF will support a \agrid stencil: where the vector
component array locations $u_{ij}$ and $v_{ij}$ are located at the
cell center $(i,j)$.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} CAM-FV, CAM-EUL, CLM, CCSM-CPL, MIT, WRF (SISL, 3DVAR), GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\sreq{\bgrid}

ESMF will support a \bgrid stencil: where the vector component array
locations $u_{ij}$ and $v_{ij}$ are located at the NE cell corner
$(i+\frac12,j+\frac12)$. Both NE and SW flavors are supported.

\begin{reqlist}
{\bf Priority:} 1.\\ 
{\bf Source:} Required by POP, CICE, MIT, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\sreq{\cgrid}

ESMF will support a \cgrid stencil: where the vector component array
locations $u_{ij}$ and $v_{ij}$ are located on the N and E faces
$(i+\frac12,j)$ and $(i,j+\frac12)$ respectively. Both NE and SW
flavors are supported.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} Required by CAM-FV, POP, MIT, WRF, GFDL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\sreq{\dgrid}

ESMF will support a \dgrid stencil: where the vector component array
locations $u_{ij}$ and $v_{ij}$ are located on the E and N faces
$(i,j+\frac12)$ and $(i+\frac12,j)$ respectively. Both NE and SW
flavors are supported.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} Required by CAM-FV, MIT. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.
\end{reqlist}

\sreq{\egrid}

ESMF will support a \egrid stencil: where the vector component array
locations $u_{ij}$ and $v_{ij}$ are (include specification of E-grid here).

\begin{reqlist}
{\bf Priority:} 2\\ 
{\bf Source:} WRF (MesoNH). \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test.
\end{reqlist}

\part{Requirements for Specific Grid Types} \label{DG:gridtypes}

The distributed grid module will provide support the following 
physical grids:

\req{Tripolar grid}

The tripolar grid \cite{ref:m1996} is used to address the pole problem
in ocean models, by creating a grid with two poles in the Northern
Hemisphere, both over land. This creates a grid topology with a
fold. Vector components experience sign reversal on crossing a fold;
also some points on the vector stencil may be redundant.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} POP, CICE, GFDL, MIT. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\sreq{Vector component reversal}

Going over the fold of a tripolar grid requires both vector components
to flip sign.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} POP, CICE, GFDL, MIT. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
\end{reqlist}

\sreq{Redundancy enforcement}

Certain locations on a staggered grid have multiple index locations
for a single physical location. While these points are redundant, the
data there may diverge because of FP roundoff error. ESMF will provide
methods to enforce exact redundancy.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} POP, CICE, MIT, GFDL \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\sreq{Validity of grid}

It must be possible to check if the grid and fold are conformant:
for instance, a southern fold with a \bgrid~ stencil needs an extra
vector row at the southern edge.

\begin{reqlist}
{\bf Priority:} 2. \\ 
{\bf Source:} POP, CICE, MIT, GFDL. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\req{Cubed-sphere grid}

The cubed-sphere grid \cite{ref:rpm1996} is used to address the pole
problem in ocean models, by creating a grid with eight weak poles,
which may also be moved over land if one chooses. This creates a grid
topology where vector components may need to be interchanged
($(u,v)\longrightarrow(v,-u)$) on crossing a cube edge. Some points on
the vector stencil may be redundant.

\sreq{Vector component interchange}

ESMF will correctly treat vector components crossing faces of a cubed
sphere to perform the appropriate component interchanges.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} MIT \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Needed for a milestone.
\end{reqlist}

\sreq{Redundancy enforcement}

Certain locations on a staggered grid have multiple index locations
for a single physical location. While these points are redundant, the
data there may diverge because of FP roundoff error. ESMF will provide
methods to enforce exact redundancy.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} MIT \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:}
\end{reqlist}

\req{Spectral grid}

Spectral models generally have three associated grids, one in physical
space, one in Fourier space, and one in spectral (wavenumber) space.
The sequence of transformations to pass data between the grids is
treated at its highest level within the Regrid semantics. Within
these, there is generally a specific step to redistribute data to
optimize specific operations (FFTS and LTs). This section will
highlight the specific requirements of these redistributions.

\sreq{Globalize on one axis}

There will be an efficient method to create an array where all the
global data is available along one of the axes of distribution.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} see Req.~\ref{DG:PartGather}\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Already covered by Req.~\ref{DG:PartGather}, but
  highlighted here.
\end{reqlist}

\sreq{Transpose axis of globalization}

There will be an efficient method to transpose an array global along
one axis, into one global along another. Note that this is a matrix
transpose, as opposed to the general redistribution that we've called
a data transpose in~\ref{DG:transpose}.

\begin{reqlist}
{\bf Priority:} 1 \\
{\bf Source:} See Req.~\ref{DG:PartGather}\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Already covered by Req.~\ref{DG:PartGather}, but
  highlighted here.
\end{reqlist}

\req{Icosahedral grid}

See \cite{art:heikes+:geodesic,art:majewski+:gme} for extensive
discussions on these grids.

\begin{reqlist}
{\bf Priority:} 3. \\ 
{\bf Source:} FV, POP, CICE \\
{\bf Status:} Deferred \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Envisioned for FV, but not a milestone.  POP, CICE
             currently funded to do this under CSU SciDAC effort
             but ESMF involvement will occur in future.
\end{reqlist}

\req{Reduced grids}

The domain decomposition definition operations will support reduced
grids.

\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:} NCEP-GSM \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} NCEP will clarify this.
\end{reqlist}

\req{Nested grids}

Nested grids are overlapping grids with certain properties that may be
possible to exploit for efficiency. Many of the requirements having to
do with data exchange between nested grids will appear in the physical grid
and Regrid documents. Some requirements of nested grids appear here:
these concern the special case of \emph{mesh-aligned} nested
grids. Nesting is defined to be mesh-aligned when every coarse grid
point in the region of coverage of a fine nest is also a point on the
fine grid. The following requirements apply to mesh-aligned nested
grids:

\sreq{Discrete data shift on moving nests}

A method will be provided for data shifting by integral grid intervals
along axes of decomposition on a distributed moving mesh-aligned
nested grid.

\begin{reqlist}
{\bf Priority:} 2 \\
{\bf Source:} WRF \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} i.e, a moving mesh-aligned nested grid may support a
  lateral data shift: ``move all points on this distributed grid 2
  points south and 1 east''.
\end{reqlist}

\req{Unstructured grids and ungridded data} \label{DG:Unstructured}.

Unstructured grids and ungridded location streams will come associated
with an underlying background grid (see~\ref{DG:terms}). Requirements
in this section use the background grid to define operations on
unstructured grids and ungridded location streams. For the purpose of
a distributed grid, unstructured grids and ungridded location streams are
aligned on a single axis, each index of which is associated with a
background grid cell. After the association is done, the requirements
for the background grid cascade from \textbf{PhysGrid}, but are
highlighted here.

\sreq{Grid association}

It shall be possible to associate a structured grid with unstructured
grids and ungridded location streams.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} PSAS, NSIPP, NCEP-SSI (milestone), MIT(assimilation  and lagrangian diagnostics) \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} The method to generate the background grid requires
  location information, and belongs to the physical grid.  Needed
  for PSAS, but not a milestone.
\end{reqlist}

\sreq{Domain decomposition}

It shall be possible to apply domain decomposition to unstructured
grids and ungridded location streams, using the background grid.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} PSAS, NSIPP, NCEP-SSI (milestone), MIT(assimilation  and lagrangian diagnostics) \\
{\bf Status:} Approved-1. \\ 
{\bf Verification:} Unit test. \\
{\bf Notes:}  Needed for PSAS, but not a milestone.
\end{reqlist}

\sreq{Distributed grid operations}

It shall be possible to apply all distributed grid operations (halo update,
data transpose, global reductions, scatter/gather) to unstructured
grids and ungridded location streams, using the background grid.

\begin{reqlist}
{\bf Priority:} 1. \\ 
{\bf Source:} PSAS, NSIPP, NCEP-SSI (milestone), MIT(assimilation and lagrangian diagnostics) \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} Needed for PSAS, but not a milestone.
\end{reqlist}
