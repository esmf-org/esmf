   % $Id: TimeMgr_req.tex,v 1.4 2005/04/26 18:20:59 eschwab Exp $


%======================================================================================
\req{Time intervals}
\label{req:tp_tv}
%--------------------------------------------------------------------------------------

\sreq{Specifying time intervals}
\label{req:spec-tint}
Time intervals specified by the user shall be represented at the interface by the 
sum of some subset of the quantities {\bf D, S and S\_nd, MS, NS, d, m, s, ms, ns}
together with an optional sign.  Shortcut interfaces that provide for the following 
interval representations: {\bf S; D+S; s} are required.  

\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} WRF uses {\bf S} to specify timesteps and will use {\bf S\_nd}; \\
CAM-EUL, CAM-FV, FMS codes use a {\bf D+S} representation for time intervals; 
NSIPP, HIM and MITgcm use {\bf s}; 
POP, CICE require all but {\bf S\_nd, NS, m, ms};
NCEP requires signed {\bf s, h} and {\bf D+H+M+S+MS};
WRF and GFDL desire {\bf S\_nd} for model enhancement \\
{\bf Status:} Approved-1 for all except {\bf S\_nd}; 
approved-2 for {\bf S\_nd}.\\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} Methods that require time interval specification can be designed with 
a generic interface.  Such an interface would allow the user to select the subset of
time specifiers included in the argument list.  This would satisfy the needs of 
target codes and would also allow the interface to be extended to include other 
time units.  The generic interface would be implemented in F90 using named optional 
arguments.  The same approach is suggested for time instants. 
\end{reqlist}

\sreq{Time intervals as return values}
\label{sec:query-tinterval}
It shall be possible to return the value of a time interval in a variety of 
representations.  These shall include the combinations listed in \ref{sec:spec-tint}
plus {\bf d, h, m, s, ms}. For returned time periods, the value of each time quantity, 
such as {\bf S}, is bounded by the next larger quantity in the representation.  For 
example, for a {\bf D+S} representation under a Gregorian calendar, the value {\bf S} that is 
returned will be such that {\bf S} $<=$ 86399 (the length of a Gregorian calendar day in
seconds).
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} CAM-EUL requires {\bf D+S} and {\bf d}; 
GFDL requires {\bf D+S} and {\bf S};
NCEP requires {\bf d, h, m, s, ms};
NSIPP, HIM, MITgcm require {\bf s};
POP, CICE require {\bf d, s}. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} A general conversion method between time representations may be a compact 
way to meet this requirement.
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Resolution}
A clear statement and consistent implementation of the resolution used in time interval
calculations is required.  A default precision of at least {\bf US} is required to meet the
current needs of target applications; {\bf NS} is desired by some applications for extensibility.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} CAM-EUL, GFDL, CAM-FV require {\bf S};  
NCEP-ATM, SSI, NSIPP require {\bf MS}; 
WRF requires {\bf TTS}; 
MITgcm requires {\bf US}; 
POP, CICE require {\bf US}; 
MITgcm desires {\bf NS}. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:}  It should be possible to accommodate the highest resolution desired, {\bf NS},
without difficulty.  
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Range of time intervals}
It shall be possible to use the \funcname to run an application over a range of at 
least 200,000 years.  
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} CAM-FV, NCEP, POP, CICE require at least 20,000 years; 
CAM-EUL, GFDL, MITgcm and NSIPP require a range of at least 200,000 years. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} should be possible to encompass the largest range desired.  
A pair of 64-bit integers can represent, in seconds and atto-seconds ($10^{-18}s$), 
a time range of about 300 billion years!
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Operations}

%--------------------------------------------------------------------------------------
\ssreq{Change value}
A time interval may have its value changed.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for GFDL, MITgcm, CAM-FV, NSIPP, CAM-EUL, WRF.\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

\ssreq{Copy}
A time interval may be copied to another time interval. 
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for GFDL, NSIPP, MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\ 
{\bf Notes:}  This can be satisfied by using a time interval 
query \ref{sec:query-tinterval} and change value combination.
\end{reqlist}

\ssreq{Comparison}
A pair of time intervals can be compared for magnitude, equality, inequality
 and ordering.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for GFDL, NSIPP, CAM-EUL, CAM-FV, MITgcm, WRF.\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

\ssreq{Increment and decrement}
A time interval can be incremented or decremented by another time interval.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for GFDL, NSIPP, NCEP-ATM, CAM-EUL, CAM-FV, POP, CICE, MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

\ssreq{Division}
A time interval can be divided by another time interval, resulting in a
fraction that expresses the relative magnitudes of the two time intervals.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for GFDL codes. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} This is useful for some time interpolation procedures.
Supporting exact division implies supporting an {\bf\_{nd}} fraction representation.
\end{reqlist}

\ssreq{Subdivision}
A time interval may be divided into an integer number of equally sized intervals. 
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for CICE, GFDL; desired for POP and CAM-FV, WRF. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} Exact subdivision requires {\bf S\_nd} support and possibly an {\bf \_nd} 
representation of the divisor.  This operation can be done by application code 
provided the time interval query capability \ref{req:query-tinterval} returns a 
full description. 
\end{reqlist}

\ssreq{Multiplication}
A time interval may be multiplied by an integer or a floating point number. 
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for GFDL, MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:}  Can be done by application code provided query capability 
\ref{req:query-tinterval} returns a full description. \\
Exact multiplication requires {\bf \_nd} support for multiplication factor.
\end{reqlist}

\ssreq{Magnitude}
The absolute value of a time interval is required.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Desired for GFDL codes (FMS time types are positive). \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:}  Can be done by application code provided query capability 
\ref{sec:query-tinterval} returns a full description. 
Exact magnitude requires 
{\bf S$_{nd}$} support.
\end{reqlist}

\ssreq{Return in string format}
Time intervals can be returned formatted as strings.  As applicable, the
default string format shall be that defined by ISO8601.
\begin{reqlist}
{\bf Priority:} 3. \\ 
{\bf Source:} Required for NCEP; desired by POP, CICE, MITgcm, WRF. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:}  Formatting could be done by applications, assuming a full query 
capability.  Discussion of the format flexibility that might be required can be 
found under \cite{javaCalendar}.
\end{reqlist}

\ssreq{Unary negation}
A time interval can be negated, e.g. {\tt timeInterval} = -{\tt timeInterval}.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for NOAA/NCEP, NCAR/WRF, and MIT/MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} Required for performing 4-dimensional variational data assimilation, digital filter initialization, and other functions.
\end{reqlist}

%======================================================================================
\req{Time instants}
\label{req:time_instants}
\label{req:ti}

%--------------------------------------------------------------------------------------
\sreq{Units and representation} 
Time instants specified by the user shall be represented at the interface by the 
combination of some subset of the quantities {\bf YR, MM, DD, H, M, S, MS, NS, O,
d,h,m,s} 
and the calendar type.  Shortcut interfaces shall be provided for the following time 
instant representations {\bf s; YR+MM+DD+S, YR+MM+DD+HH+M+S}. A generic interface for a 
full specification of all terms shall also be provided.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} NSIPP, HIM, MITgcm require {\bf s}; 
CAM-EUL and CAM-FV require {\bf YR+MM+DD+S};
MITgcm, GFDL requires {\bf YR+MM+DD+HH+M+S}; 
POP, CICE require {\bf YR+MM+DD+HH+M+S, d, s}; \\
WRF requires {\bf YR+MM+DD+H+M+S, YR+MM+DD+H+M+S\_nd} \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} The ranges of the date components {\bf YR, MM, DD} are
calendar specific.  The ranges of the time of day components {\bf M, s} are
not constrained to be between 0 and 60.  It is, for example, possible to
express the time of day using the {\bf s} component only.  
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Consistency with time interval}
Time resolution of a time instant must be consistent with that of a time interval.
Consistency is defined in the following way:  the result of incrementing/decrementing 
any representable time instant by any representable time interval must be a representable 
time instant, assuming it lies within the valid range of the calendar.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All applications require this basic constraint.\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Supported calendars}
\label{req:calendar}

\ssreq{Gregorian calendar}
Time instants may use the Gregorian calendar and UTC times.  The required 
range of dates is as wide as possible, but certainly not less than 10,000 years.
\begin{reqlist}
{\bf Priority:} 1.\\
{\bf Source:} Required for NSIPP, CAM-FV, CAM-EUL, POP, CICE, MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} The available range of Gregorian dates using the standard 
Fliegel et al.\cite{Fli68} algorithm is from November 24, -4713 onward.
Support for leap seconds is {\bf not} required.
\end{reqlist}

\ssreq{No-leap calendar}
Time instants may use a no-leap year calendar which is the same as the Gregorian
except that it does not include leap year corrections.  
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for CAM-EUL, GFDL, POP, CICE, MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

\ssreq{Julian calendar}
Full Julian calendar support is required.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for GFDL, NSIPP. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

\ssreq{360-day and generic calendar}
\label{req:gencal}
The \funcname should provide support for a generic calendar.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for GFDL, POP, CICE, MITgcm, desired for NSIPP.  \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:}
Often it is useful to perform an idealized simulation with a calendar
that is an approximation to an actual calendar. A commonly used
configuration is a 360 day year containing 12 months of 30 days each.
Each day is exactly 86400 seconds. The period of rotation is
assumed to be exactly one day and the orbital period around the Sun
is assumed to be exactly one year.
These settings are a useful approximation for the Earth. However, for other
planets, or for idealized parameter space exploration experiments, the year 
length and day length need to be adjusted. A generic calendar may be
specified by the number of days in each month of the year or by 
the length of the year, and the day
length.  The year length need not be an integer
number of days, for example on Venus a year would be 0.926 days.
The range of the year number for generic calendars is -200,000 to
200,000.
\end{reqlist}

\ssreq{No calendar option}
Time instants may use a ``no calendar'' option.
\begin{reqlist}
{\bf Priority:} 3. \\
{\bf Source:} May be useful for CAM-EUL and MITgcm, WRF. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:}  It is possible to achieve this capability by ignoring the year in 
\ref{req:gencal}.  The {\bf YR} and {\bf MM} components of a time instant
are ignored under the ``no calendar'' option.  The range of the day number,
{\bf DD}, will be at least the number of days in 200,000 years.
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Operations}

\ssreq{Change time instant value}
All the components, except the calendar, of a time instant can be changed.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required by CAM-EUL, GFDL, NSIPP, CAM-FV, MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

\ssreq{Copy}
A time instant can be copied to another time instant.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for GFDL, NSIPP, MITgcm, desired for CAM-EUL, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

\ssreq{Comparison}
A pair of time instants can be checked for equality or to determine
which is the later or earlier of the pair.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for GFDL, POP, CICE, CAM-EUL, CAM-FV, MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

\ssreq{Increment or decrement by time interval}
Time instants can be incremented or decremented by time intervals.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for GFDL, POP, CICE, CAM-FV, CAM-EUL, MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} These methods are {\em exact}. 
\end{reqlist}

\ssreq{Increment or decrement by a calendar interval}
Time instants can be incremented or decremented by years, months, or seconds.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Desired for CAM-EUL, NSIPP, MITgcm. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} Clocks conventionally operate so that increments by a month are
rounded down to nearest date within the month you incremented up to!
e.g. Jan 31 + {\bf MM} == Jan 30th + {\bf MM} ==
Jan 29th + {\bf MM} == Feb 28th ( or 29th in a leap year).
Jan 31 + 2{\bf MM} == March 31. Support for {\bf S}$_{nd}$ will
be required.
\end{reqlist}

\ssreq{Interval between time instants}
A method shall be provided to calculate the time interval between a pair 
of time instants.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for CAM-FV, GFDL, POP, CICE, CAM-EUL, MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} These methods are {\em exact}.
\end{reqlist}

\ssreq{Return in string format}
Time instants may be returned formatted as strings.  As applicable, the default string format shall be that defined by ISO8601.
\begin{reqlist}
{\bf Priority:} 3. \\
{\bf Source:} Desired for NCEP, POP, CICE, CAM-EUL, MITgcm, WRF. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} Formatting can be done by applications.
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Queries}

\ssreq{Standard queries}
A time instant may be queried for any of the values of 
{\bf YR, MM, DD, H, M, S, O, MS, NS, d, h, m, s},
and the calendar type. A query make take an {\bf O} value
which specifies an amount by which the returned time-instant
is offset relative to its internal {\bf O=0} value.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} All applications require a query that supports some subset of the
list above;
CAM-EUL requires {\bf YR, MM, DD, S}. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} Time instant components will be returned in canonical
form with {\bf H} in the range 0 to 23, {\bf M} in the range 0 to 59, and
{\bf s} in the range 0 to 59.999... depending on precision.
\end{reqlist}

\ssreq{Query day of year}
A time instant may be queried for the day of the year represented as a 
floating point number with the fractional part representing the time of day.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for NCEP, CAM-EUL; desired for NSIPP, MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

\ssreq{Query day of week}
A time instant may be queried for the day of the week.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for NCEP, desired for NSIPP. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

\ssreq{Query day of month}
A time instant may be queried for the day of the month.
\begin{reqlist}
{\bf Priority:} 3. \\
{\bf Source:} Desired for CAM-EUL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

\ssreq{Query middle of month}
A time instant may be queried for the time instant of the middle of the month
that the time instant falls in.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for POP, CICE, NSIPP. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

\ssreq{Query julian day}
A time instant may be queried for its Julian day.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for NCEP. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} NCEP codes rely on this. 
\end{reqlist}

\ssreq{Query hardware realtime clock}
Return the actual hardware realtime clock time instant in the UTC time zone.  

\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for NCEP, CAM-EUL; desired for NSIPP, MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} In order to support synchronization with an external clock, the hardware 
realtime clock must be returned in a format valid as an input to a time instant change 
value method.
\end{reqlist}

%======================================================================================
\req{Clocks}
\label{req:clocks}

%--------------------------------------------------------------------------------------
\sreq{Clock initialization}
A clock is initialized by start and stop time instants, timestep interval,
and an optional reference time instant.  The default value of the reference time 
instant is the start time instant.  The reference time is used by the clock to 
provide time coordinate values for the simulation in the form of elapsed time since a reference time.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for CAM-FV, CAM-EUL, MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Multiple clocks}
Components should be able to create and manipulate multiple clocks.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for MITgcm, WRF, desired for CAM-FV. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} In many numerical approaches several different time-steps are 
used for different elements of the system. Multiple clocks are important to keep
track of these different time-steps. Ensemble simulations may also require
members to proceed with different temporal trajectories, all within a single 
component.
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{List of clocks}
Components should be able to get a list of their clocks.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for NSIPP, desired for CAM-FV, MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test.
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Operations}

\ssreq{Advance method}
A clock has an advance method.  When the clock is advanced the clock's time instant is
incremented by the clock's current timestep interval. 
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for CAM-FV, NSIPP, CAM-EUL, MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} This functionality can easily be achieved without the concept of a
clock, by incrementing a generic time instant with a time interval.  The clock 
concept bundles this capability with others that are closely related, such as the   
ability to get the value of the previous time instant.
\end{reqlist}

%--------------------------------------------------------------------------------------
\ssreq{Reset timestep interval}
A clock's timestep interval can be changed.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for CAM-FV, POP, MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

%--------------------------------------------------------------------------------------
\ssreq{Change clock current time instant}
A clock's current time instant can be changed.  This action causes the previous 
time instant to be reset to the current time instant. The clock timestep
counter does not change.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for CAM-EUL, NSIPP, MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

%--------------------------------------------------------------------------------------
\ssreq{Restore clock state}
A clock can be returned to its exact state from a previous run.
This is to support a component's restart capability.  The clock must be
able to provide its state to the component, and be able to reset its state.
The component is responsible for the persistence of the clock's state data.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for CAM-FV, POP, CICE, CAM-EUL, MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}

%--------------------------------------------------------------------------------------
\ssreq{Synchronize with external clock}
The ability to synchronize or ``attach'' a clock to an external source should be supported.
\begin{reqlist}
{\bf Priority:} 2.\\
{\bf Source:} Required for NCEP. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} ? 
{\bf Notes:} Forecast scenarios require latching key events to actual wall-clock time. 
\end{reqlist}

%--------------------------------------------------------------------------------------
\ssreq{Reverse mode}
Following the initialization of a clock and a set of associated alarms, to be able to "reverse" the time-stepping direction anytime after the first {\tt ESMF\_ClockAdvance()} call.  Each subsequent call to {\tt ESMF\_ClockAdvance()} will then subtract, rather than add, the timeStep from the currentTime.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for NOAA/NCEP, NCAR/WRF, and MIT/MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} Required for performing 4-dimensional variational data assimilation, digital filter initialization, and other functions.
\end{reqlist}

%--------------------------------------------------------------------------------------
\ssreq{Alternate between forward and reverse modes}
While in "reverse" mode, either before or after the clock reaches its end point ({\tt startTime}), to be able to switch back to "forward" mode.   In general, to be able to switch back and forth between "forward" and "reverse" mode anytime during or after a single clock run.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for NOAA/NCEP, NCAR/WRF, and MIT/MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} Required for performing 4-dimensional variational data assimilation, digital filter initialization, and other functions.
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Queries}

\ssreq{Query number of timesteps}
A clock can be queried for the number of times the advance method has
been called.  This is also known as the timestep number.  It is initialized to 
zero and increases monotonically.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for POP, CICE; desired for NSIPP, CAM-EUL, MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

%--------------------------------------------------------------------------------------
\ssreq{Query timestep interval}
A clock can be queried for the current timestep interval.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for POP, CAM-FV, CAM-EUL, MITgcm, WRF. \\
{\bf Status:} Proposed-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

%--------------------------------------------------------------------------------------
\ssreq{Query start, stop, reference time}
A clock can be queried for the start, stop, or reference time instants.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for POP, CICE, CAM-FV, CAM-EUL, MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

%--------------------------------------------------------------------------------------
\ssreq{Query current or previous time instants}
A clock can be queried for the previous or current time instants.
The current time instant is equal to the start time
instant until the first call of the advance method.
The previous time instant is equal to the current time
instant until the first call of the advance method.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for POP, CICE, CAM-EUL; query current time instant required by CAM-FV, MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

%--------------------------------------------------------------------------------------
\ssreq{Query current or previous simulation times}
A clock can be queried for the previous or current simulation times.
The current simulation time is the time interval between
the current time instant and the reference time instant.  Previous
simulation time is defined analogously.
\begin{reqlist}
{\bf Priority:} 2.\\
{\bf Source:} Required for POP, CICE; desired for CAM-FV; query current simulation time 
required by MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

%--------------------------------------------------------------------------------------
\ssreq{``Is Later'' query}
A clock can be queried for whether or not the current time instant
equals or is later than the stop time instant.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for POP, CICE, CAM-FV, MITgcm; desired for CAM-EUL, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\ 
{\bf Notes:} This capability may be necessary in order to implement alarms.
\end{reqlist}

%--------------------------------------------------------------------------------------
\ssreq{Reverse, ``Is Before'' query}
While in "reverse" mode, if advanced far enough, the clock will stop when it originally began (at its {\tt startTime}).
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for NOAA/NCEP, NCAR/WRF, and MIT/MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} Required for performing 4-dimensional variational data assimilation, digital filter initialization, and other functions.
\end{reqlist}

%--------------------------------------------------------------------------------------
\ssreq{Query number of timesteps in reverse mode}
While in "reverse" mode, the clock's {\tt advanceCount} (the number of time steps taken) will be decremented, rather than incremented, upon each call to {\tt ESMF\_ClockAdvance()}.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for NOAA/NCEP, NCAR/WRF, and MIT/MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} Required for performing 4-dimensional variational data assimilation, digital filter initialization, and other functions.
\end{reqlist}

%======================================================================================
\req{Alarms}
\label{req:alarms}

%--------------------------------------------------------------------------------------
\sreq{Alarm initialization}
An alarm is initialized by specifying the clock to which it is associated 
and its ringing times. 
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for CAM-EUL, CAM-FV, NSIPP, POP, CICE, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

\sreq{Multiple alarms per component}
Components should be able to create and manipulate multiple alarms.
Each alarm is associated with one and only one clock; one clock may
be associated with multiple alarms.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for CAM-EUL, CAM-FV, NSIPP, POP, CICE, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{List and print of alarms}
Components should be able to get a list and create a print record of their alarms.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for NSIPP. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Alarm states}
An alarm can be either on (i.e., ringing) or off (i.e., quiet).
The alarm on/off state is set when the alarm is initialized, and can be queried
at any time by the application.  The alarm is turned on if the clock's current 
time instant is later than or equal to the current ringing time and the previous 
time instant was before the current ringing time.  Otherwise the alarm is off.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for CAM-EUL, CAM-FV, NSIPP, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Ring criteria}

\ssreq{Ring at time instant}
An alarm can be set to ring at a single time instant.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for NSIPP, POP, CICE, CAM-EUL, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} This capability can also be accomplished with a comparison 
of time instants. 
\end{reqlist}

\ssreq{Ring at interval}
An alarm can be set to ring at regular intervals, for example
at the beginning, middle or end of some period.  The ringing times are 
specified by a starting time instant (offset), a time interval, and an optional 
stopping time instant.
\begin{reqlist}
{\bf Priority:} \\
{\bf Source:} Required for NSIPP, CAM-FV, POP, CICE, CAM-EUL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test.  
\end{reqlist}

\ssreq{Initial ring state}
At initialization it should be possible to
specify whether ringing is enabled immediately, or whether
ringing tests are deferred until after the next clock update.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for NSIPP, POP, CICE. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test.  
\end{reqlist}

\ssreq{Ring in reverse }
While in "reverse" time-stepping mode, alarms will ring in "reverse," i.e., an alarm will begin to ring at the end of its {\tt ringDuration} (or {\tt ringTimeStepCount}), and stop ringing when it originally began (at its {\tt ringTime}).
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for NOAA/NCEP, NCAR/WRF, and MIT/MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
{\bf Notes:} Required for performing 4-dimensional variational data assimilation, digital filter initialization, and other functions.
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Alarm turn-off}
Alarms are only turned on by the clock.  A ringing alarm may be turned off 
either by a clock update operation that assesses whether the current time instant
lies within an interval during which the alarm should be on, and if not turns it off; 
or an operation that simply turns the alarm off. 
application.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for NSIPP, CAM-FV, POP, CICE, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test.  
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Restore alarm state}
An alarm can be returned to its exact state from a previous run.
This is to support a component's restart capability.  The alarm must be
able to provide its state to the component, and be able to reset its state.
The component is responsible for the persistence of the alarms state data.
\begin{reqlist}
{\bf Priority:} \\
{\bf Source:} Required for NSIPP, POP, CICE, CAM-FV, CAM-EUL, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test.  
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Alarm queries}
Alarms have query methods for previous, current, and next ringing times.
When an alarm is initialized the previous ringing time is set to the current ringing time.
\begin{reqlist}
{\bf Priority:} \\
{\bf Source:} Required for POP, CICE, desired for NSIPP. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test.  
\end{reqlist}

%======================================================================================
\req{Accuracy of calculations}
\label{req:precision}
Accuracy of calculations with time instants and time intervals.

%--------------------------------------------------------------------------------------
\sreq{Exact increment and decrement}
Incrementing or decrementing time instants by exact time intervals is exact.
By exact incrementing of time instants by time intervals we mean the following.
Given a time instant $\tau_{init}$ and a time interval $i_{1}$,
incrementing $\tau_{init}$ by $i_{1}$ $N$ successive times gives the same
result as incrementing $\tau_{init}$ by an interval $i_{N}$ where $i_{N}$
is the result of incrementing $i_{1}$ by $i_{1}$, $(N-1)$ times.  Exact
decrementing is defined analogously.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for CAM-FV, GFDL, NSIPP, CAM-EUL, desired for MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test.  
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Exact interval calculation}
Calculating the interval between exact time instants is exact.
\begin{reqlist}
{\bf Priority:} \\
{\bf Source:} Required for CAM-FV, GFDL, NSIPP, CAM-EUL, desired for MITgcm, WRF. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. \\
{\bf Notes:} 
Given time instants $\tau_{init}$ and $\tau_{final}$, then the calculated
difference between these instants, $i_{1}$, has the property that 
incrementing $\tau_{init}$ by $i_{1}$ gives $\tau_{final}$.
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Exact subdivision}
Exact division of time intervals into an integral number of subintervals.

To ensure a drift free clock the following behavior must be true:

if adding (or subtracting) a time interval, $i_{1}$, to a time 
instant $\tau_{init}$ yields a new time instant $\tau_{final}$ i.e.

$\tau_{final}=\tau_{init}+i_1 $

then it must be possible to specify a fractional time 
interval $i_{2} = \frac{1}{2}\times i_{1}$ such that

$\tau_{final}=\tau_{init}+i_1\equiv\tau_{init}+i_2+i_2 $

and similarly for $i_{3} = \frac{1}{3}\times i_{1}$, $i_{n,m} = \frac{n}{m}\times i_{1}$.
\begin{reqlist}
{\bf Priority:} \\
{\bf Source:} Desired for CAM-FV, GFDL, MITgcm, WRF. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\  
{\bf Notes:}Such behavior is not possible with finite-precision floating
point arithmetic.  The fractional second part of both time instants and
time intervals must be able to exactly represent rational values.  If
partial seconds represented as rational numbers is supported, then the
precision of time intervals and time instances must be $1/N$ seconds where
$N$ is the largest value of the denominator.  Thus an {\bf \_nd} representation
is required to fully support this.
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Floating point accuracy consistent with time step}
Clock accuracy comparable with numerical scheme accuracy should be supported.
Applications that employ an adaptive time-step for their numerical
procedures need to be able to drive their time manager clocks with that step.
This should be possible even for application time steps that are arbitrary 
floating point numbers i.e. not a whole number of seconds, or minutes.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for NSIPP, MITgcm. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. 
\end{reqlist}

%======================================================================================
\req{Cross-component clock and alarm queries}
\label{req:sharing}.

%--------------------------------------------------------------------------------------
\sreq{Cross-component query}
Components should be able to query the clock(s) or alarms of another
component and components should be able to manipulate certain clock(s) 
and alarms of another component.
\begin{reqlist}
{\bf Priority:} \\
{\bf Source:} Desired for POP, CICE, NSIPP, MITgcm. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:}
Synchronized shutdown notifications will be sent to components through clock
and alarm settings. These notifications may be generated by a high-level control program
or a coupler component. However, components should be able to determine 
which clocks and alarms can be externally manipulated so that they can assume that
certain clocks and alarms are private.
\end{reqlist}

%--------------------------------------------------------------------------------------
\sreq{Clock and alarm labels}
Components should be able to "label" their clocks and alarms.
\begin{reqlist}
{\bf Priority:} \\
{\bf Source:} Required for POP, CICE, MITgcm; desired for NSIPP. \\
{\bf Status:} Approved-2. \\
{\bf Verification:} Unit test. \\
{\bf Notes:}
When coordinating notions of time among components with several
clocks or alarms, it is important to be able to identify the role of 
each clock or alarm.
For instance, a component might want to declare a master clock that 
defines the overall time within a component, or components
might need to declare a standard alarm that can be used
by a higher-level driver layer or a coupler component to trigger 
the generation of restart information or to trigger a clean shutdown.
\end{reqlist}

%======================================================================================
\req{General computational requirements}

%--------------------------------------------------------------------------------------
\sreq{Error handling}
\label{req:errors}

The \funcname services must conform to the error handling specifications described 
in the {\it ESMF General Requirements} document \cite{ESMFGenReq} and, when available, 
the {\it ESMF Error Handling Requirements} document.  The requirements below are some
special error handling capabilities needed for the \funcname.

\ssreq{Check validity}
A time interval or time instant may have its validity checked.  An invalid time 
interval should create a recoverable error condition so that a component can decide 
on the error action.
\begin{reqlist}
{\bf Priority:} 1. \\
{\bf Source:} Required for CAM-EUL, CAM-FV, GFDL, NSIPP, MITgcm.\\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. 
\end{reqlist}

\sreq{Overloaded arithmetic operators}
Overloaded arithmetic operator syntax should be used for time instant and
time interval operations such as increment and decrement.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for GFDL; useful for CAM-EUL. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}

\sreq{Automatic memory deallocation}
It shall be possible to create a time interval, time instant, clock or 
alarm as a local variable, so that is not necessary to explicitly free the memory 
associated with it. 
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Required for GFDL; desired for CAM-EUL, CAM-FV, NCEP, MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\ 
{\bf Notes:} This requirement implies that internal pointers are not allowed.  
If deletion is not automatic, a destructor will be required. 
\end{reqlist}

\sreq{Temporary objects}
A shall be possible to create temporary clocks and alarms.
\begin{reqlist}
{\bf Priority:} 2. \\
{\bf Source:} Desired for NSIPP, MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Interface inspection, unit test. \\
\end{reqlist}

\sreq{Thread safety}
Operations on time intervals and time instants will be thread-safe.
\begin{reqlist}
{\bf Priority:} 3. \\
{\bf Source:} Useful for CAM-EUL, MITgcm. \\
{\bf Status:} Approved-1. \\
{\bf Verification:} Unit test. 
\end{reqlist}
 
%======================================================================================















